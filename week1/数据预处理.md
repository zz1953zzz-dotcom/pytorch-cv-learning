import os
import pandas as pd
import torch

os.makedirs(os.path.join("..","data"),exist_ok = True)      #将data文件夹创建在上级目录
data_file = os.path.join('..','data','house_tiny.csv')      #在data文件夹下创建csv文件
with open(data_file,'w') as f:
    f.write('NumRooms,Alley,Price\n')
    f.write('NA,Pave,127500\n')
    f.write('2,NA,106000\n')
    f.write('4,NA,178100\n')
    f.write('NA,NA,140000\n')

data = pd.read_csv(data_file)
print(data)

#处理缺失值
#为了处理缺失的数据，典型的方法包括插值法和删除法， 其中插值法用一个替代值弥补缺失值，而删除法则直接忽略缺失值。
inputs,outputs = data.iloc[:,0:2],data.iloc[:,2]
inputs['NumRooms'] = inputs['NumRooms'].fillna(inputs['NumRooms'].mean())
print(inputs)
inputs = pd.get_dummies(inputs,dummy_na = True)
#pandas会自动识别文本列并将其转换为虚拟变量（one-hot编码）
print(inputs)

#现在inputs和outputs中的所有条目都是数值类型，它们可以转换为张量格式
import torch

X = torch.tensor(inputs.to_numpy(dtype=float))
y = torch.tensor(outputs.to_numpy(dtype=float))


#课后练习作业：
import os
import pandas as pd
import torch
import numpy as ny

#创建一个csv文件
data_file = os.path.join('data','homework.csv')
with open(data_file,'w') as f:
    f.write('cost,count,price,profit\n')
    f.write('100,50,200,5000\n')
    f.write('150,NaN,180,3800\n')
    f.write('NaN,30,250,6000\n')
    f.write('120,40,NaN,4800\n')
    f.write('180,NaN,220,7200\n')
data = pd.read_csv(data_file)
print('原始数据集为\n',data)

#data.isnull.sum() -> 按列求和
#data.isnull.sum(axis = 1) -> 按行求和

max_NaN_count_col = data.isnull().sum().idxmax()
max_NaN_count = data.isnull().sum().max()
print("\n缺失值最多的列是:",max_NaN_count_col,"缺失值有:",max_NaN_count,"个")
data_processed = data.drop(columns=max_NaN_count_col)
print("\n删除缺失值最多的列后的数据为：\n",data_processed)
inputs,outputs = data_processed.iloc[:,0:2],data_processed.iloc[:,-1]
inputs = inputs.fillna(inputs.mean())
print("\n处理缺失值后的输入数据为:\n",inputs)
X = torch.tensor(inputs.to_numpy(dtype = float))
Y = torch.tensor(outputs.to_numpy(dtype = float))
print('\n转换为张量之后的输入数据为:\n',X,'\n输出数据为:\n',Y)